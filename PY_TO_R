library(shiny)
library(DiagrammeR)

ui <- fluidPage(
  titlePanel("ML Pipeline"),
  tabsetPanel(
    tabPanel("Workflow",
             br(),
             grVizOutput("workflow", height = "520px")
    )
    # ... your other tabs ...
  )
)

server <- function(input, output, session){
  
  output$workflow <- renderGrViz({
    grViz("
      digraph mlflow {
        graph [rankdir = TB, nodesep=0.4, ranksep=0.55]
        node  [shape=diamond, style=filled, fontname=Helvetica, color=grey40]

        // main steps
        raw   [label='Raw Data',                  fillcolor='#c6dbef']
        prep  [label='Pre-process\\n(Imputation)',fillcolor='#fdd0a2']
        tune  [label='Hyperparameter Tuning\\n(10-fold CV, Optuna)', fillcolor='#fee6ce']
        eval  [label='Model Evaluation',          fillcolor='#c6dbef']
        expl  [label='Explain Model\\n(SHAP)',    fillcolor='#a1d99b']

        // sub-steps under evaluation
        node  [shape=box, style=filled]
        ss    [label='SS', fillcolor='white']
        ms    [label='MS', fillcolor='white']
        vt    [label='VT', fillcolor='white']

        // layout
        raw -> prep -> tune -> eval
        eval -> { ss ms vt }
        { ss ms vt } -> expl

        // optional grouping look
        subgraph cluster_eval {
          label='Evaluation Setups'
          color=grey80
          style=dashed
          ss ms vt
        }
      }
    ")
  })
}

shinyApp(ui, server)
